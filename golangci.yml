# golangci-lint configuration for state-machine-amz-gin

run:
  # Timeout for analysis
  timeout: 5m
  
  # Include test files
  tests: true
  
  # Directories to skip
  skip-dirs:
    - vendor
    - bin
    - dist
    - .git
  
  # Files to skip
  skip-files:
    - ".*\\.pb\\.go$"
    - ".*_generated\\.go$"

output:
  # Format: colored-line-number|line-number|json|tab|checkstyle|code-climate
  format: colored-line-number
  
  # Print lines of code with issue
  print-issued-lines: true
  
  # Print linter name in the end of issue text
  print-linter-name: true
  
  # Make issues output unique by line
  uniq-by-line: true
  
  # Sort results by: filepath, line and column
  sort-results: true

linters:
  # Disable all linters
  disable-all: true
  
  # Enable specific linters
  enable:
    # Enabled by default
    - errcheck      # Check for unchecked errors
    - gosimple      # Simplify code
    - govet         # Reports suspicious constructs
    - ineffassign   # Detects ineffectual assignments
    - staticcheck   # Go static analysis
    - typecheck     # Type checking
    - unused        # Check for unused constants, variables, functions and types
    
    # Additional recommended linters
    - asasalint     # Check for pass []any as any in variadic func(...any)
    - asciicheck    # Check for non-ASCII identifiers
    - bidichk       # Check for dangerous unicode character sequences
    - bodyclose     # Check whether HTTP response body is closed successfully
    - contextcheck  # Check the function whether use a non-inherited context
    - decorder      # Check declaration order and count of types, constants, variables and functions
    - dogsled       # Check for too many blank identifiers
    - dupl          # Code clone detection
    - durationcheck # Check for two durations multiplied together
    - errname       # Check that sentinel errors are prefixed with Err and error types are suffixed with Error
    - errorlint     # Error wrapping recommendations
    - exhaustive    # Check exhaustiveness of enum switch statements
    - exportloopref # Check for pointers to enclosing loop variables
    - forbidigo     # Forbid specific identifiers
    - gci           # Control golang package import order
    - gocheckcompilerdirectives # Check for go:build and other compiler directives
    - gochecknoinits # Check for init functions
    - gocognit      # Compute and check the cognitive complexity of functions
    - goconst       # Find repeated strings that could be replaced by a constant
    - gocritic      # Meta-linter providing many checks
    - gocyclo       # Compute and check the cyclomatic complexity of functions
    - godot         # Check if comments end in a period
    - gofmt         # Check whether code was gofmt-ed
    - gofumpt       # Check whether code was gofumpt-ed (stricter gofmt)
    - goimports     # Check import statements are formatted according to goimports
    - gomnd         # Detect magic numbers
    - gomoddirectives # Manage the use of 'replace', 'retract', and 'excludes' directives in go.mod
    - gomodguard    # Allow and block list linter for direct Go module dependencies
    - goprintffuncname # Check that printf-like functions are named with f at the end
    - gosec         # Inspect source code for security problems
    - grouper       # Analyze expression groups
    - importas      # Enforce consistent import aliases
    - interfacebloat # Check the number of methods inside an interface
    - lll           # Report long lines
    - loggercheck   # Check key-value pairs for common logger libraries
    - makezero      # Find slice declarations with non-zero initial length
    - mirror        # Report wrong mirror patterns of bytes/strings usage
    - misspell      # Find commonly misspelled English words in comments
    - nakedret      # Find naked returns in functions greater than a specified function length
    - nestif        # Report deeply nested if statements
    - nilerr        # Find code that returns nil even if it checks that the error is not nil
    - nilnil        # Check that there is no simultaneous return of nil error and an invalid value
    - noctx         # Find sending http request without context.Context
    - nolintlint    # Report ill-formed or insufficient nolint directives
    - nosprintfhostport # Check for misuse of Sprintf to construct a host with port in a URL
    - predeclared   # Find code that shadows one of Go's predeclared identifiers
    - promlinter    # Check Prometheus metrics naming via promlint
    - reassign      # Check that package variables are not reassigned
    - revive        # Fast, configurable, extensible, flexible, and beautiful linter for Go
    - rowserrcheck  # Check whether Err of rows is checked successfully
    - sqlclosecheck # Check that sql.Rows and sql.Stmt are closed
    - stylecheck    # Replacement for golint
    - tenv          # Detect using os.Setenv instead of t.Setenv
    - testableexamples # Check if examples are testable
    - testpackage   # Make sure tests and production code are in separate packages
    - thelper       # Detect golang test helpers without t.Helper() call
    - tparallel     # Detect inappropriate usage of t.Parallel() method
    - unconvert     # Remove unnecessary type conversions
    - unparam       # Report unused function parameters
    - usestdlibvars # Detect the possibility to use variables/constants from the Go standard library
    - wastedassign  # Find wasted assignment statements
    - whitespace    # Detect leading and trailing whitespace
    
    # Disabled (can be enabled as needed)
    # - cyclop        # Calculate cyclomatic complexities of functions
    # - depguard      # Go linter that checks if package imports are in a list of acceptable packages
    # - exhaustruct   # Check if all structure fields are initialized
    # - funlen        # Detects long functions
    # - gochecknoglobals # Check that no global variables exist
    # - godox         # Detect FIXME, TODO and other comment keywords
    # - goerr113      # Check error handling expressions
    # - goheader      # Check file headers
    # - ireturn       # Accept interfaces, return concrete types
    # - maintidx      # Measure maintainability index
    # - nlreturn      # Check for a new line before return and branch statements
    # - nonamedreturns # Report named returns
    # - paralleltest  # Detect missing usage of t.Parallel()
    # - prealloc      # Find slice declarations that could potentially be preallocated
    # - tagliatelle   # Check struct tags
    # - testifylint   # Checks usage of github.com/stretchr/testify
    # - varnamelen    # Check variable name length
    # - wrapcheck     # Check that errors are wrapped
    # - wsl           # Whitespace linter

linters-settings:
  errcheck:
    # Report about not checking of errors in type assertions: `a := b.(MyStruct)`
    check-type-assertions: true
    
    # Report about assignment of errors to blank identifier: `num, _ := strconv.Atoi(numStr)`
    check-blank: false
    
    # List of functions to exclude from checking
    exclude-functions:
      - (io.Closer).Close
      - (*database/sql.Rows).Close
      - (*database/sql.DB).Close

  govet:
    # Enable all analyzers
    enable-all: true
    
    # Disable specific analyzers
    disable:
      - fieldalignment  # Too strict for this project
    
    # Settings per analyzer
    settings:
      shadow:
        strict: true

  gofmt:
    # Simplify code: gofmt with `-s` option
    simplify: true

  goimports:
    # Put imports beginning with prefix after 3rd-party packages
    local-prefixes: github.com/hussainpithawala/state-machine-amz-gin

  gocyclo:
    # Minimal code complexity to report
    min-complexity: 15

  gocognit:
    # Minimal code complexity to report
    min-complexity: 20

  dupl:
    # Tokens count to trigger issue
    threshold: 100

  goconst:
    # Minimal length of string constant
    min-len: 3
    
    # Minimum occurrences to report
    min-occurrences: 3
    
    # Ignore test files
    ignore-tests: true

  misspell:
    # Correct spellings using locale preferences
    locale: US
    
    ignore-words:
      - cancelled  # British spelling that we use

  lll:
    # Max line length, lines longer will be reported
    line-length: 120
    
    # Tab width in spaces
    tab-width: 4

  nakedret:
    # Make an issue if func has more lines of code than this setting and it has naked returns
    max-func-lines: 30

  gomnd:
    # List of enabled checks, see https://github.com/tommy-muehle/go-mnd/#checks for description.
    checks:
      - argument
      - case
      - condition
      - operation
      - return
      - assign
    
    # List of numbers to exclude from analysis
    ignored-numbers:
      - '0'
      - '1'
      - '2'
      - '10'
      - '100'
      - '1000'

  gosec:
    # To specify a set of rules to explicitly exclude
    excludes:
      - G104  # Audit errors not checked (covered by errcheck)
    
    # Confidence level: low, medium, high
    confidence: medium

  gocritic:
    # Enable multiple checks by tags
    enabled-tags:
      - diagnostic
      - style
      - performance
      - experimental
      - opinionated
    
    disabled-checks:
      - whyNoLint      # We use nolint comments
      - unnamedResult  # We use named returns sometimes

  revive:
    # Enable all available rules
    enable-all-rules: false
    
    # Sets the default failure confidence
    confidence: 0.8
    
    rules:
      - name: blank-imports
      - name: context-as-argument
      - name: context-keys-type
      - name: dot-imports
      - name: error-return
      - name: error-strings
      - name: error-naming
      - name: exported
      - name: if-return
      - name: increment-decrement
      - name: var-naming
      - name: var-declaration
      - name: package-comments
      - name: range
      - name: receiver-naming
      - name: time-naming
      - name: unexported-return
      - name: indent-error-flow
      - name: errorf
      - name: empty-block
      - name: superfluous-else
      - name: unused-parameter
      - name: unreachable-code
      - name: redefines-builtin-id
      - name: function-result-limit
        arguments: [3]
      - name: line-length-limit
        arguments: [120]
      - name: cognitive-complexity
        arguments: [20]
      - name: cyclomatic
        arguments: [15]

  stylecheck:
    # Select checks to enable
    checks: ["all", "-ST1000", "-ST1003", "-ST1016", "-ST1020", "-ST1021", "-ST1022"]
    
    # Initialize only when called
    initialisms: ["ACL", "API", "ASCII", "CPU", "CSS", "DNS", "EOF", "GUID", "HTML", "HTTP", "HTTPS", "ID", "IP", "JSON", "QPS", "RAM", "RPC", "SLA", "SMTP", "SQL", "SSH", "TCP", "TLS", "TTL", "UDP", "UI", "GID", "UID", "UUID", "URI", "URL", "UTF8", "VM", "XML", "XMPP", "XSRF", "XSS", "SIP", "RTP", "AMQP", "DB", "TS"]

  testpackage:
    # Regexp pattern to skip files
    skip-regexp: (export|internal)_test\.go

issues:
  # List of regexps of issue texts to exclude
  exclude-rules:
    # Exclude some linters from running on tests files
    - path: _test\.go
      linters:
        - gocyclo
        - errcheck
        - dupl
        - gosec
        - gomnd
        - goconst
    
    # Exclude some linters from running on example files
    - path: example_.*\.go
      linters:
        - errcheck
        - gosec
    
    # Exclude known linters from partially hard-vendored code
    - path: vendor/
      linters:
        - all
    
    # Exclude magic number warnings for common HTTP status codes
    - text: "mnd: Magic number: (200|201|204|400|401|403|404|500|503)"
      linters:
        - gomnd
    
    # Allow underscore in test names
    - path: _test\.go
      text: "should not use underscores in Go names"
      linters:
        - stylecheck
    
    # Allow dot imports in tests
    - path: _test\.go
      text: "should not use dot imports"
      linters:
        - revive
  
  # Maximum issues count per one linter
  max-issues-per-linter: 0
  
  # Maximum count of issues with the same text
  max-same-issues: 0
  
  # Show only new issues
  new: false
  
  # Fix found issues (if it's supported by the linter)
  fix: false
